<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Analysis Dashboard - GenAI-RAG-EEG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .metric-card { transition: transform 0.2s; }
        .metric-card:hover { transform: translateY(-2px); }
        .passed { background-color: #d1fae5; color: #065f46; }
        .failed { background-color: #fee2e2; color: #991b1b; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">Comprehensive Analysis Framework</h1>
                    <p class="text-blue-100">GenAI-RAG-EEG v4.0 - Clinical Validation & Performance Analysis</p>
                </div>
                <a href="/" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50">Back to Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4">
            <div class="flex space-x-4 overflow-x-auto">
                <button onclick="showTab('data')" id="tab-data" class="tab-btn tab-active px-4 py-3 font-medium">Data Quality</button>
                <button onclick="showTab('accuracy')" id="tab-accuracy" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Accuracy Analysis</button>
                <button onclick="showTab('subject')" id="tab-subject" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Subject Analysis</button>
                <button onclick="showTab('clinical')" id="tab-clinical" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Clinical Validation</button>
                <button onclick="showTab('reliability')" id="tab-reliability" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Reliability</button>
                <button onclick="showTab('model')" id="tab-model" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Model Analysis</button>
                <button onclick="showTab('loso')" id="tab-loso" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">LOSO</button>
                <button onclick="showTab('features')" id="tab-features" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Features</button>
                <button onclick="showTab('workload')" id="tab-workload" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Workload</button>
                <button onclick="showTab('metrics')" id="tab-metrics" class="tab-btn px-4 py-3 font-medium text-gray-600 hover:text-blue-600">Metrics</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-6">
        <!-- Data Quality Tab -->
        <div id="content-data" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Data Completeness -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">Data Completeness</h3>
                    <div id="data-completeness" class="space-y-3"></div>
                </div>

                <!-- Outlier Detection -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-orange-600">Outlier Detection</h3>
                    <div id="outlier-detection" class="space-y-3"></div>
                </div>

                <!-- SNR Estimation -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">Signal Quality (SNR)</h3>
                    <div id="snr-estimation"></div>
                </div>

                <!-- Class Distribution -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">Class Distribution</h3>
                    <div id="class-distribution"></div>
                </div>

                <!-- Data Integrity Scores -->
                <div class="bg-white rounded-lg shadow-md p-6 col-span-full">
                    <h3 class="text-lg font-semibold mb-4">Data Integrity Scores</h3>
                    <div id="integrity-scores" class="grid grid-cols-3 gap-4"></div>
                </div>
            </div>
        </div>

        <!-- Accuracy Analysis Tab -->
        <div id="content-accuracy" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- All Metrics by Dataset -->
                <div class="bg-white rounded-lg shadow-md p-6 col-span-full">
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">Classification Metrics by Dataset</h3>
                    <div id="accuracy-all-metrics" class="overflow-x-auto"></div>
                </div>

                <!-- Confidence Intervals -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">95% Confidence Intervals</h3>
                    <canvas id="confidence-interval-chart" height="250"></canvas>
                </div>

                <!-- Per-Class Analysis -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">Per-Class Analysis</h3>
                    <div id="per-class-analysis"></div>
                </div>

                <!-- Error Analysis -->
                <div class="bg-white rounded-lg shadow-md p-6 col-span-full">
                    <h3 class="text-lg font-semibold mb-4 text-red-600">Error Analysis</h3>
                    <div id="error-analysis" class="grid grid-cols-2 gap-4"></div>
                </div>
            </div>
        </div>

        <!-- Subject Analysis Tab -->
        <div id="content-subject" class="tab-content hidden">
            <div class="grid grid-cols-1 gap-6">
                <!-- Subject Variability Stats -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Subject Variability Statistics</h3>
                    <div id="subject-variability" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>

                <!-- Subject Performance Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Subject-Wise Performance Distribution</h3>
                    <canvas id="subject-chart" height="150"></canvas>
                </div>

                <!-- Outlier Subjects -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-orange-600">Outlier Subject Detection</h3>
                    <div id="outlier-subjects"></div>
                </div>

                <!-- Subject Consistency -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">Cross-Session Consistency</h3>
                    <div id="subject-consistency" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>

                <!-- Subject Table -->
                <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                    <h3 class="text-lg font-semibold mb-4">Per-Subject Results</h3>
                    <table class="min-w-full" id="subject-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left">Subject</th>
                                <th class="px-4 py-2 text-left">Samples</th>
                                <th class="px-4 py-2 text-left">Accuracy</th>
                                <th class="px-4 py-2 text-left">F1 Score</th>
                                <th class="px-4 py-2 text-left">Precision</th>
                                <th class="px-4 py-2 text-left">Recall</th>
                                <th class="px-4 py-2 text-left">Kappa</th>
                            </tr>
                        </thead>
                        <tbody id="subject-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Clinical Validation Tab -->
        <div id="content-clinical" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Diagnostic Validity -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">Diagnostic Validity Metrics</h3>
                    <div id="diagnostic-metrics" class="space-y-3"></div>
                </div>

                <!-- Clinical Thresholds -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">Clinical Threshold Compliance</h3>
                    <div id="clinical-thresholds" class="space-y-2"></div>
                </div>

                <!-- Agreement Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">Agreement Analysis</h3>
                    <div id="agreement-metrics"></div>
                </div>

                <!-- Risk Assessment -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-600">Risk Assessment</h3>
                    <div id="risk-metrics"></div>
                </div>

                <!-- Clinical Composite Score -->
                <div class="bg-white rounded-lg shadow-md p-6 col-span-full">
                    <h3 class="text-lg font-semibold mb-4">Clinical Composite Score</h3>
                    <div id="composite-score" class="text-center"></div>
                </div>
            </div>
        </div>

        <!-- Reliability Tab -->
        <div id="content-reliability" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Test-Retest -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Test-Retest Reliability</h3>
                    <div id="test-retest"></div>
                </div>

                <!-- Robustness Testing -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Noise Robustness</h3>
                    <canvas id="robustness-chart" height="200"></canvas>
                </div>

                <!-- Artifact Resistance -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Artifact Resistance</h3>
                    <div id="artifact-resistance"></div>
                </div>

                <!-- Cross-Session Stability -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Cross-Session Stability</h3>
                    <div id="session-stability"></div>
                </div>
            </div>
        </div>

        <!-- Model Analysis Tab -->
        <div id="content-model" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Architecture -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Architecture Analysis</h3>
                    <div id="architecture-info"></div>
                </div>

                <!-- Training Analysis -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Training Analysis</h3>
                    <div id="training-info"></div>
                </div>

                <!-- Ablation Study -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Ablation Study</h3>
                    <canvas id="ablation-chart" height="200"></canvas>
                </div>

                <!-- Deployment Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Deployment Metrics</h3>
                    <div id="deployment-info"></div>
                </div>
            </div>
        </div>

        <!-- LOSO Analysis Tab -->
        <div id="content-loso" class="tab-content hidden">
            <div class="grid grid-cols-1 gap-6">
                <!-- Aggregate Stats -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">LOSO Aggregate Statistics</h3>
                    <div id="loso-aggregate" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>

                <!-- Subject-wise Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Subject-Wise Performance</h3>
                    <canvas id="loso-chart" height="150"></canvas>
                </div>

                <!-- Subject Table -->
                <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                    <h3 class="text-lg font-semibold mb-4">Per-Subject Results</h3>
                    <table class="min-w-full" id="loso-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left">Subject</th>
                                <th class="px-4 py-2 text-left">Accuracy</th>
                                <th class="px-4 py-2 text-left">Precision</th>
                                <th class="px-4 py-2 text-left">Recall</th>
                                <th class="px-4 py-2 text-left">F1</th>
                                <th class="px-4 py-2 text-left">AUC</th>
                                <th class="px-4 py-2 text-left">Score</th>
                            </tr>
                        </thead>
                        <tbody id="loso-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Feature Engineering Tab -->
        <div id="content-features" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Time Domain -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">Time-Domain Features</h3>
                    <div id="time-features"></div>
                </div>

                <!-- Spatial Features -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">Spatial Features</h3>
                    <div id="spatial-features"></div>
                </div>

                <!-- Frequency Features -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">Frequency Features</h3>
                    <div id="frequency-features"></div>
                </div>

                <!-- Preprocessing Pipeline -->
                <div class="bg-white rounded-lg shadow-md p-6 col-span-full">
                    <h3 class="text-lg font-semibold mb-4">Adaptive Preprocessing Pipeline</h3>
                    <div id="preprocessing-pipeline"></div>
                </div>
            </div>
        </div>

        <!-- Cognitive Workload Tab -->
        <div id="content-workload" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Class Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">4-Class Performance</h3>
                    <canvas id="workload-chart" height="200"></canvas>
                </div>

                <!-- Confusion Matrix -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Confusion Matrix</h3>
                    <div id="confusion-matrix" class="flex justify-center"></div>
                </div>

                <!-- Aggregate Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Aggregate Metrics</h3>
                    <div id="workload-aggregate"></div>
                </div>

                <!-- Adjacent Confusion -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Ordinal Consistency Analysis</h3>
                    <div id="ordinal-analysis"></div>
                </div>
            </div>
        </div>

        <!-- Metrics Matrix Tab -->
        <div id="content-metrics" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Classification Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">Classification Metrics</h3>
                    <div id="classification-metrics"></div>
                </div>

                <!-- Training Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-green-600">Training Metrics</h3>
                    <div id="training-metrics"></div>
                </div>

                <!-- Deployment Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">Deployment Metrics</h3>
                    <div id="deployment-metrics"></div>
                </div>

                <!-- Reliability Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4 text-orange-600">Reliability Metrics</h3>
                    <div id="reliability-metrics"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('tab-active');
                el.classList.add('text-gray-600');
            });
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            document.getElementById(`tab-${tabName}`).classList.remove('text-gray-600');
        }

        // Load data
        async function loadAllData() {
            try {
                const [clinical, reliability, model, loso, features, workload, metrics, thresholds, preprocessing, dataQuality, accuracy, subject] = await Promise.all([
                    fetch('/api/analysis/clinical-validation').then(r => r.json()),
                    fetch('/api/analysis/reliability-matrix').then(r => r.json()),
                    fetch('/api/analysis/model-analysis').then(r => r.json()),
                    fetch('/api/analysis/loso-results').then(r => r.json()),
                    fetch('/api/analysis/feature-engineering').then(r => r.json()),
                    fetch('/api/analysis/cognitive-workload').then(r => r.json()),
                    fetch('/api/analysis/performance-metrics').then(r => r.json()),
                    fetch('/api/analysis/clinical-thresholds').then(r => r.json()),
                    fetch('/api/analysis/preprocessing').then(r => r.json()),
                    fetch('/api/analysis/data-quality').then(r => r.json()),
                    fetch('/api/analysis/accuracy').then(r => r.json()),
                    fetch('/api/analysis/subject').then(r => r.json())
                ]);

                renderDataQuality(dataQuality);
                renderAccuracyAnalysis(accuracy);
                renderSubjectAnalysis(subject);
                renderClinicalValidation(clinical, thresholds);
                renderReliability(reliability);
                renderModelAnalysis(model);
                renderLOSO(loso);
                renderFeatures(features, preprocessing);
                renderWorkload(workload);
                renderMetrics(metrics);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function renderDataQuality(data) {
            // Data Completeness
            const completenessHtml = Object.entries(data.missing_data).map(([ds, val]) => `
                <div class="flex justify-between items-center p-3 bg-green-50 rounded">
                    <span class="font-medium">${ds}</span>
                    <div class="text-right">
                        <span class="font-bold text-green-600">${val.completeness}%</span>
                        <span class="text-xs text-gray-500 ml-2">${val.quality}</span>
                    </div>
                </div>
            `).join('');
            document.getElementById('data-completeness').innerHTML = completenessHtml;

            // Outlier Detection
            const outlierHtml = Object.entries(data.outlier_detection.results).map(([ds, val]) => `
                <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                    <span class="font-medium">${ds}</span>
                    <div class="text-right">
                        <span class="text-orange-600">${val.outlier_pct}% outliers</span>
                        <span class="font-bold text-green-600 ml-2">${val.clean_data_pct}% clean</span>
                    </div>
                </div>
            `).join('');
            document.getElementById('outlier-detection').innerHTML = outlierHtml;

            // SNR Estimation
            const snrHtml = Object.entries(data.snr_estimation).map(([ds, val]) => `
                <div class="flex justify-between items-center p-3 border-b">
                    <span class="font-medium">${ds}</span>
                    <div class="text-right">
                        <span class="font-bold">${val.snr_db} dB</span>
                        <span class="ml-2 px-2 py-1 text-xs rounded ${val.quality === 'Excellent' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">${val.quality}</span>
                    </div>
                </div>
            `).join('');
            document.getElementById('snr-estimation').innerHTML = snrHtml;

            // Class Distribution
            const classDistHtml = Object.entries(data.class_distribution).map(([ds, val]) => `
                <div class="p-3 border-b">
                    <div class="font-medium mb-2">${ds}</div>
                    <div class="flex justify-between text-sm">
                        ${Object.entries(val).filter(([k]) => !['imbalance_ratio', 'is_balanced'].includes(k)).map(([k, v]) => `<span>${k}: ${v}</span>`).join('')}
                    </div>
                    <div class="mt-1 text-xs ${val.is_balanced ? 'text-green-600' : 'text-orange-600'}">
                        ${val.is_balanced ? '✓ Balanced' : '⚠ Imbalanced'} (ratio: ${val.imbalance_ratio})
                    </div>
                </div>
            `).join('');
            document.getElementById('class-distribution').innerHTML = classDistHtml;

            // Integrity Scores
            const integrityHtml = Object.entries(data.integrity_scores).map(([ds, val]) => `
                <div class="text-center p-4 bg-gradient-to-b from-${val.grade === 'A' ? 'green' : 'blue'}-50 to-white rounded-lg border">
                    <div class="text-2xl font-bold text-${val.grade === 'A' ? 'green' : 'blue'}-600">${val.overall}%</div>
                    <div class="text-sm font-medium">${ds}</div>
                    <div class="text-3xl font-bold mt-2">${val.grade}</div>
                    <div class="text-xs text-gray-500 mt-2">
                        Complete: ${val.completeness}% | Clean: ${val.outlier_score}%
                    </div>
                </div>
            `).join('');
            document.getElementById('integrity-scores').innerHTML = integrityHtml;
        }

        function renderAccuracyAnalysis(data) {
            // All Metrics Table
            const datasets = Object.keys(data.all_metrics);
            const metrics = ['accuracy', 'precision', 'recall', 'f1_score', 'specificity', 'auc_roc', 'cohen_kappa', 'mcc'];

            const tableHtml = `
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">Metric</th>
                            ${datasets.map(ds => `<th class="px-4 py-2 text-center">${ds}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${metrics.map(m => `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="px-4 py-2 font-medium capitalize">${m.replace(/_/g, ' ')}</td>
                                ${datasets.map(ds => {
                                    const val = data.all_metrics[ds][m];
                                    return `<td class="px-4 py-2 text-center font-bold">${val < 1 && val > 0 ? val.toFixed(3) : val}${val > 1 ? '%' : ''}</td>`;
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('accuracy-all-metrics').innerHTML = tableHtml;

            // Confidence Interval Chart
            const ciCtx = document.getElementById('confidence-interval-chart').getContext('2d');
            const ciData = data.confidence_intervals;
            const ciDatasets = Object.entries(ciData).map(([ds, metrics], idx) => ({
                label: ds,
                data: Object.entries(metrics).map(([m, v]) => v.mean),
                backgroundColor: idx === 0 ? 'rgba(59, 130, 246, 0.5)' : 'rgba(16, 185, 129, 0.5)',
                borderColor: idx === 0 ? '#3b82f6' : '#10b981',
                borderWidth: 1
            }));
            new Chart(ciCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(Object.values(ciData)[0]).map(m => m.replace(/_/g, ' ')),
                    datasets: ciDatasets
                },
                options: {
                    scales: { y: { min: 90, max: 100, title: { display: true, text: 'Score (%)' } } },
                    plugins: { title: { display: true, text: 'Metrics with 95% CI' } }
                }
            });

            // Per-Class Analysis
            const perClassHtml = Object.entries(data.per_class_analysis).map(([ds, classes]) => `
                <div class="mb-4">
                    <div class="font-medium text-gray-700 mb-2">${ds}</div>
                    ${Object.entries(classes).map(([cls, m]) => `
                        <div class="flex justify-between p-2 ${cls === 'Baseline' ? 'bg-blue-50' : 'bg-red-50'} rounded mb-1">
                            <span class="font-medium">${cls}</span>
                            <span class="text-sm">P: ${m.precision.toFixed(3)} | R: ${m.recall.toFixed(3)} | F1: ${m.f1.toFixed(3)}</span>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            document.getElementById('per-class-analysis').innerHTML = perClassHtml;

            // Error Analysis
            const errorHtml = Object.entries(data.error_analysis).map(([ds, e]) => `
                <div class="p-4 bg-red-50 rounded-lg">
                    <div class="font-medium text-lg mb-2">${ds}</div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>Total Errors: <span class="font-bold">${e.total_errors}</span></div>
                        <div>Error Rate: <span class="font-bold">${(e.error_rate * 100).toFixed(1)}%</span></div>
                        <div>False Positives: <span class="font-bold text-orange-600">${e.false_positives}</span></div>
                        <div>False Negatives: <span class="font-bold text-red-600">${e.false_negatives}</span></div>
                        <div>FP Rate: <span class="font-bold">${(e.fp_rate * 100).toFixed(1)}%</span></div>
                        <div>FN Rate: <span class="font-bold">${(e.fn_rate * 100).toFixed(1)}%</span></div>
                    </div>
                </div>
            `).join('');
            document.getElementById('error-analysis').innerHTML = errorHtml;
        }

        function renderSubjectAnalysis(data) {
            const stats = data.variability;

            // Subject Variability
            const variabilityHtml = `
                <div class="text-center p-4 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-600">${stats.accuracy_stats.mean.toFixed(1)}%</div>
                    <div class="text-sm">Mean Accuracy</div>
                    <div class="text-xs text-gray-500">± ${stats.accuracy_stats.std.toFixed(1)}%</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-600">${stats.f1_stats.mean.toFixed(3)}</div>
                    <div class="text-sm">Mean F1</div>
                    <div class="text-xs text-gray-500">± ${stats.f1_stats.std.toFixed(3)}</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded">
                    <div class="text-2xl font-bold text-purple-600">${stats.subjects_above_90}</div>
                    <div class="text-sm">Subjects >90%</div>
                    <div class="text-xs text-gray-500">of ${stats.n_subjects} total</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded">
                    <div class="text-2xl font-bold text-orange-600">${(stats.accuracy_stats.cv * 100).toFixed(1)}%</div>
                    <div class="text-sm">CV</div>
                    <div class="text-xs text-gray-500">Variability</div>
                </div>
            `;
            document.getElementById('subject-variability').innerHTML = variabilityHtml;

            // Subject Chart
            const subjectCtx = document.getElementById('subject-chart').getContext('2d');
            new Chart(subjectCtx, {
                type: 'bar',
                data: {
                    labels: data.per_subject.map(s => s.subject_id),
                    datasets: [{
                        label: 'Accuracy (%)',
                        data: data.per_subject.map(s => s.accuracy),
                        backgroundColor: data.per_subject.map(s => s.accuracy >= 90 ? '#22c55e' : s.accuracy >= 80 ? '#f97316' : '#ef4444')
                    }]
                },
                options: {
                    scales: { y: { min: 70, max: 100 } },
                    plugins: { legend: { display: false } }
                }
            });

            // Outlier Subjects
            const outlierHtml = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-red-50 rounded">
                        <div class="font-medium text-red-700">Low Performers</div>
                        <div class="mt-2">${data.outlier_subjects.low_performers.length > 0 ? data.outlier_subjects.low_performers.join(', ') : 'None detected'}</div>
                    </div>
                    <div class="p-4 bg-green-50 rounded">
                        <div class="font-medium text-green-700">High Performers</div>
                        <div class="mt-2">${data.outlier_subjects.high_performers.length > 0 ? data.outlier_subjects.high_performers.join(', ') : 'None detected'}</div>
                    </div>
                </div>
                <div class="mt-2 text-sm text-gray-500">Method: ${data.outlier_subjects.method} (threshold: ${data.outlier_subjects.threshold})</div>
            `;
            document.getElementById('outlier-subjects').innerHTML = outlierHtml;

            // Subject Consistency
            const consistencyHtml = `
                <div class="text-center p-4 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-600">${data.consistency.test_retest_correlation}</div>
                    <div class="text-sm">Test-Retest r</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-600">${data.consistency.session_stability}</div>
                    <div class="text-sm">Session Stability</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded">
                    <div class="text-2xl font-bold text-purple-600">${data.consistency.mean_difference}</div>
                    <div class="text-sm">Mean Diff</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded">
                    <div class="text-2xl font-bold text-orange-600">${data.consistency.consistency_score}</div>
                    <div class="text-sm">Consistency</div>
                </div>
            `;
            document.getElementById('subject-consistency').innerHTML = consistencyHtml;

            // Subject Table
            const tbodyHtml = data.per_subject.slice(0, 15).map(s => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 font-medium">${s.subject_id}</td>
                    <td class="px-4 py-2">${s.n_samples}</td>
                    <td class="px-4 py-2 ${s.accuracy >= 90 ? 'text-green-600' : s.accuracy >= 80 ? 'text-orange-600' : 'text-red-600'} font-bold">${s.accuracy}%</td>
                    <td class="px-4 py-2 font-bold">${s.f1_score}</td>
                    <td class="px-4 py-2">${s.precision}</td>
                    <td class="px-4 py-2">${s.recall}</td>
                    <td class="px-4 py-2">${s.cohen_kappa}</td>
                </tr>
            `).join('');
            document.getElementById('subject-tbody').innerHTML = tbodyHtml;
        }

        function renderClinicalValidation(data, thresholds) {
            // Diagnostic Metrics
            const diagnosticHtml = Object.entries(data.diagnostic_validity).map(([key, val]) => `
                <div class="flex justify-between items-center p-2 ${val.passed ? 'bg-green-50' : 'bg-red-50'} rounded">
                    <span class="font-medium capitalize">${key.replace(/_/g, ' ')}</span>
                    <span class="font-bold ${val.passed ? 'text-green-600' : 'text-red-600'}">${typeof val.value === 'number' && val.value < 1 ? (val.value * 100).toFixed(1) + '%' : val.value + '%'}</span>
                </div>
            `).join('');
            document.getElementById('diagnostic-metrics').innerHTML = diagnosticHtml;

            // Clinical Thresholds
            const thresholdsHtml = thresholds.thresholds.map(t => `
                <div class="flex justify-between items-center p-2 ${t.passed ? 'passed' : 'failed'} rounded">
                    <span>${t.metric}</span>
                    <span>${t.achieved} (${t.threshold})</span>
                    <span>${t.passed ? '✓' : '✗'}</span>
                </div>
            `).join('');
            document.getElementById('clinical-thresholds').innerHTML = thresholdsHtml;

            // Agreement Metrics
            const agreementHtml = Object.entries(data.agreement_metrics).map(([key, val]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${key.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${val.value} (${val.interpretation})</span>
                </div>
            `).join('');
            document.getElementById('agreement-metrics').innerHTML = agreementHtml;

            // Risk Assessment
            const riskHtml = Object.entries(data.risk_assessment).map(([key, val]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${key.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${typeof val.value === 'number' ? val.value.toFixed(1) + '%' : val.value}</span>
                </div>
            `).join('');
            document.getElementById('risk-metrics').innerHTML = riskHtml;

            // Composite Score
            document.getElementById('composite-score').innerHTML = `
                <div class="text-4xl font-bold text-green-600">${data.clinical_composite_score.value}</div>
                <div class="text-gray-500 mt-2">${data.clinical_composite_score.formula}</div>
                <div class="text-lg text-green-700 mt-1">${data.clinical_composite_score.interpretation}</div>
            `;
        }

        function renderReliability(data) {
            // Test-Retest
            const testRetestHtml = Object.entries(data.test_retest_reliability).map(([key, val]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${key.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${val.value} (${val.interpretation})</span>
                </div>
            `).join('');
            document.getElementById('test-retest').innerHTML = testRetestHtml;

            // Robustness Chart
            const ctx = document.getElementById('robustness-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.robustness_testing.noise_levels.map(n => `${n.snr_db} dB`),
                    datasets: [{
                        label: 'Accuracy (%)',
                        data: data.robustness_testing.noise_levels.map(n => n.accuracy),
                        borderColor: '#3b82f6',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    scales: { y: { min: 85, max: 100 } }
                }
            });

            // Artifact Resistance
            const artifactHtml = Object.entries(data.artifact_resistance).map(([key, val]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize font-medium">${key}</span>
                    <span>Score: ${val.resistance_score}</span>
                    <span class="text-red-600">Drop: ${val.accuracy_drop_pct}%</span>
                </div>
            `).join('');
            document.getElementById('artifact-resistance').innerHTML = artifactHtml;

            // Session Stability
            const stabilityHtml = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded">
                        <div class="text-2xl font-bold text-blue-600">${data.cross_session_stability.stability_score}</div>
                        <div class="text-sm text-gray-500">Stability Score</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded">
                        <div class="text-2xl font-bold text-green-600">${data.cross_session_stability.correlation}</div>
                        <div class="text-sm text-gray-500">Correlation</div>
                    </div>
                </div>
            `;
            document.getElementById('session-stability').innerHTML = stabilityHtml;
        }

        function renderModelAnalysis(data) {
            // Architecture
            const archHtml = `
                <div class="space-y-3">
                    <div class="flex justify-between"><span>Model Type:</span><span class="font-bold">${data.architecture_analysis.model_type}</span></div>
                    <div class="flex justify-between"><span>Total Parameters:</span><span class="font-bold">${(data.architecture_analysis.total_parameters / 1000).toFixed(0)}K</span></div>
                    <hr>
                    <div class="font-medium">Component Breakdown:</div>
                    ${data.architecture_analysis.components.map(c => `
                        <div class="flex justify-between text-sm">
                            <span>${c.name}</span>
                            <span>${(c.params / 1000).toFixed(0)}K (+${c.contribution_pct}%)</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('architecture-info').innerHTML = archHtml;

            // Training
            const trainHtml = `
                <div class="space-y-3">
                    <div class="flex justify-between"><span>Convergence Epoch:</span><span class="font-bold">${data.training_analysis.convergence_epoch}</span></div>
                    <div class="flex justify-between"><span>Final Train Loss:</span><span class="font-bold">${data.training_analysis.final_train_loss}</span></div>
                    <div class="flex justify-between"><span>Final Val Loss:</span><span class="font-bold">${data.training_analysis.final_val_loss}</span></div>
                    <div class="flex justify-between"><span>Overfitting Gap:</span><span class="font-bold">${(data.training_analysis.overfitting_gap * 100).toFixed(1)}%</span></div>
                </div>
            `;
            document.getElementById('training-info').innerHTML = trainHtml;

            // Ablation Chart
            const ablationCtx = document.getElementById('ablation-chart').getContext('2d');
            const ablationData = Object.entries(data.ablation_study).filter(([k]) => k !== 'baseline');
            new Chart(ablationCtx, {
                type: 'bar',
                data: {
                    labels: ablationData.map(([k]) => k.replace('without_', '-')),
                    datasets: [{
                        label: 'Contribution (%)',
                        data: ablationData.map(([, v]) => v.contribution),
                        backgroundColor: '#8b5cf6'
                    }]
                }
            });

            // Deployment
            const deployHtml = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded">
                        <div class="text-2xl font-bold text-blue-600">${data.deployment_metrics.inference_time_gpu_ms}ms</div>
                        <div class="text-sm">GPU Latency</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded">
                        <div class="text-2xl font-bold text-green-600">${data.deployment_metrics.throughput_samples_per_sec}</div>
                        <div class="text-sm">Samples/sec</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded">
                        <div class="text-2xl font-bold text-purple-600">${data.deployment_metrics.memory_footprint_mb}MB</div>
                        <div class="text-sm">Memory</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded">
                        <div class="text-2xl font-bold text-orange-600">${data.deployment_metrics.model_size_mb}MB</div>
                        <div class="text-sm">Model Size</div>
                    </div>
                </div>
            `;
            document.getElementById('deployment-info').innerHTML = deployHtml;
        }

        function renderLOSO(data) {
            // Aggregate Stats
            const agg = data.aggregate;
            const aggHtml = `
                <div class="text-center p-4 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-600">${agg.mean_accuracy.toFixed(1)}%</div>
                    <div class="text-sm">Mean Accuracy</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-600">${agg.mean_f1.toFixed(3)}</div>
                    <div class="text-sm">Mean F1</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded">
                    <div class="text-2xl font-bold text-purple-600">${agg.mean_auc.toFixed(3)}</div>
                    <div class="text-sm">Mean AUC</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded">
                    <div class="text-2xl font-bold text-orange-600">${(agg.inter_subject_variability * 100).toFixed(1)}%</div>
                    <div class="text-sm">Variability</div>
                </div>
            `;
            document.getElementById('loso-aggregate').innerHTML = aggHtml;

            // LOSO Chart
            const losoCtx = document.getElementById('loso-chart').getContext('2d');
            new Chart(losoCtx, {
                type: 'bar',
                data: {
                    labels: data.subjects.map(s => s.subject_id),
                    datasets: [{
                        label: 'F1 Score',
                        data: data.subjects.map(s => s.f1),
                        backgroundColor: data.subjects.map(s => s.f1 >= agg.mean_f1 ? '#22c55e' : '#f97316')
                    }]
                },
                options: {
                    scales: { y: { min: 0.7, max: 1.0 } }
                }
            });

            // Subject Table
            const tbodyHtml = data.subjects.slice(0, 10).map(s => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 font-medium">${s.subject_id}</td>
                    <td class="px-4 py-2">${s.accuracy}%</td>
                    <td class="px-4 py-2">${s.precision}</td>
                    <td class="px-4 py-2">${s.recall}</td>
                    <td class="px-4 py-2 font-bold">${s.f1}</td>
                    <td class="px-4 py-2">${s.auc}</td>
                    <td class="px-4 py-2">${s.composite_score}</td>
                </tr>
            `).join('');
            document.getElementById('loso-tbody').innerHTML = tbodyHtml;
        }

        function renderFeatures(data, preprocessing) {
            // Time-domain
            const timeHtml = `
                <div class="space-y-2">
                    <div class="font-medium text-sm text-gray-500">Temporal Statistics</div>
                    <div class="flex flex-wrap gap-1">${data.time_domain_features.temporal_statistics.map(f => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${f}</span>`).join('')}</div>
                    <div class="font-medium text-sm text-gray-500 mt-3">Signal Dynamics</div>
                    <div class="flex flex-wrap gap-1">${data.time_domain_features.signal_dynamics.map(f => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${f}</span>`).join('')}</div>
                    <div class="font-medium text-sm text-gray-500 mt-3">Complexity</div>
                    <div class="flex flex-wrap gap-1">${data.time_domain_features.complexity.map(f => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${f}</span>`).join('')}</div>
                </div>
            `;
            document.getElementById('time-features').innerHTML = timeHtml;

            // Spatial
            const spatialHtml = `
                <div class="space-y-2">
                    <div class="font-medium text-sm text-gray-500">Connectivity</div>
                    <div class="flex flex-wrap gap-1">${data.spatial_features.connectivity.map(f => `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">${f}</span>`).join('')}</div>
                    <div class="font-medium text-sm text-gray-500 mt-3">Region Pooling</div>
                    <div class="flex flex-wrap gap-1">${data.spatial_features.region_pooling.map(f => `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">${f}</span>`).join('')}</div>
                </div>
            `;
            document.getElementById('spatial-features').innerHTML = spatialHtml;

            // Frequency
            const freqHtml = Object.entries(data.frequency_features.bands).map(([band, info]) => `
                <div class="p-2 border-b">
                    <div class="font-medium capitalize">${band}</div>
                    <div class="text-xs text-gray-500">${info.range}</div>
                    <div class="text-xs text-gray-400">${info.function}</div>
                </div>
            `).join('');
            document.getElementById('frequency-features').innerHTML = freqHtml;

            // Preprocessing
            const preprocHtml = `
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left">Stage</th>
                                <th class="px-4 py-2 text-left">Methods</th>
                                <th class="px-4 py-2 text-left">Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${preprocessing.standard_stages.map(s => `
                                <tr class="border-b">
                                    <td class="px-4 py-2 font-medium">${s.stage}</td>
                                    <td class="px-4 py-2 text-sm">${s.methods}</td>
                                    <td class="px-4 py-2 text-sm text-gray-500">${s.purpose}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            document.getElementById('preprocessing-pipeline').innerHTML = preprocHtml;
        }

        function renderWorkload(data) {
            // Class Metrics Chart
            const workloadCtx = document.getElementById('workload-chart').getContext('2d');
            new Chart(workloadCtx, {
                type: 'bar',
                data: {
                    labels: data.classes,
                    datasets: [
                        { label: 'Precision', data: data.classes.map(c => data.class_metrics[c].precision), backgroundColor: '#3b82f6' },
                        { label: 'Recall', data: data.classes.map(c => data.class_metrics[c].recall), backgroundColor: '#22c55e' },
                        { label: 'F1', data: data.classes.map(c => data.class_metrics[c].f1), backgroundColor: '#8b5cf6' }
                    ]
                },
                options: { scales: { y: { min: 0.8, max: 1.0 } } }
            });

            // Confusion Matrix
            const cm = data.confusion_matrix;
            const cmHtml = `
                <table class="border-collapse">
                    <tr><td></td>${data.classes.map(c => `<td class="px-3 py-1 text-xs font-medium text-center">${c}</td>`).join('')}</tr>
                    ${cm.map((row, i) => `
                        <tr>
                            <td class="px-3 py-1 text-xs font-medium">${data.classes[i]}</td>
                            ${row.map((val, j) => `<td class="px-3 py-1 text-center ${i === j ? 'bg-green-100' : val > 10 ? 'bg-red-50' : ''}">${val}</td>`).join('')}
                        </tr>
                    `).join('')}
                </table>
            `;
            document.getElementById('confusion-matrix').innerHTML = cmHtml;

            // Aggregate
            const aggHtml = Object.entries(data.aggregate_metrics).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${v}</span>
                </div>
            `).join('');
            document.getElementById('workload-aggregate').innerHTML = aggHtml;

            // Ordinal Analysis
            const ordHtml = Object.entries(data.adjacent_confusion_analysis).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${typeof v === 'number' ? (v * 100).toFixed(1) + '%' : v}</span>
                </div>
            `).join('');
            document.getElementById('ordinal-analysis').innerHTML = ordHtml;
        }

        function renderMetrics(data) {
            // Classification
            const classHtml = Object.entries(data.classification_metrics).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${typeof v.value === 'number' && v.value < 1 ? v.value.toFixed(3) : v.value + '%'}</span>
                </div>
            `).join('');
            document.getElementById('classification-metrics').innerHTML = classHtml;

            // Training
            const trainHtml = Object.entries(data.training_metrics).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${v.value}</span>
                </div>
            `).join('');
            document.getElementById('training-metrics').innerHTML = trainHtml;

            // Deployment
            const deployHtml = Object.entries(data.deployment_metrics).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${v.value}${k.includes('time') ? ' ms' : k.includes('mb') ? ' MB' : ''}</span>
                </div>
            `).join('');
            document.getElementById('deployment-metrics').innerHTML = deployHtml;

            // Reliability
            const relHtml = Object.entries(data.reliability_metrics).map(([k, v]) => `
                <div class="flex justify-between p-2 border-b">
                    <span class="capitalize">${k.replace(/_/g, ' ')}</span>
                    <span class="font-bold">${v.value}</span>
                </div>
            `).join('');
            document.getElementById('reliability-metrics').innerHTML = relHtml;
        }

        // Initialize
        loadAllData();
    </script>
</body>
</html>
